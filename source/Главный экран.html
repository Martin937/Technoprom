<?php
require_once "load.php";
$ses = new Sessions(); //$_SESSION['username']="";
if($_SESSION['username']==""){
	header('Location: avtoriz.php');
}
?>
<!DOCTYPE html>
 <html>
  <head>
   <meta charset="utf-8">
   <title>Главная</title>
   <link rel="stylesheet" href="style.css" type="text/css"/>
   <link rel="shortcut icon" href="img/favicon.png" type="image/x-icon">
   <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
	<script src="lib/leaflet/leaflet.js"></script>
	<link rel="stylesheet" href="lib/leaflet/leaflet.css" />
	<script src="lib/GeoSearch/l.control.geosearch.js"></script>
	<script src="lib/GeoSearch/l.geosearch.provider.openstreetmap.js"></script>
	<link href="css/jstree/style.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="lib/GeoSearch/l.geosearch.css" />
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/bootstrap-theme.min.css" rel="stylesheet">
	<script src="js/bootstrap.min.js"></script>
	<script src="https://api-maps.yandex.ru/2.1?apikey=2b3d9879-12e9-456c-80a2-3a98e9ed8629&load=package.full&lang=ru_RU"></script>
	<script>
	document.oncontextmenu = function (){return false};
	var myMap;
	ymaps.ready(function () {
				myMap = new ymaps.Map("YMapsID", {
				  center: [56.99, 40.97],
				  zoom: 12
				});
			  });
	function relo(a)
	{
		document.location.href = 'passKP.php?id='+a;
	}
	function pasp()
	{
		var svname = document.getElementById('svname');
		var atr = svname.getAttribute('atr');
		if(atr != null)
		{
			document.location.href ='passOrg.php?id='+atr;
		}
	}
	function DerevoDel(e, d)
	{
		var a = document.getElementById('categories').getElementsByTagName('a');
		var li = document.getElementById('categories').getElementsByTagName('li');
		for(var i=0; i < a.length; i++)
		{
			if(a[i].id==e+'_anchor')
			{
				li[i].parentNode.removeChild(li[i]); return;
			}
		}
		
		for(var i=0; i < a.length; i++)
		{
			if(a[i].id==d+'_anchor')
			{
				li[i].getElementsByTagName('i')[0].click();
				for(var i=0; i < a.length; i++)
				{
					if(a[i].id==e+'_anchor')
					{
						li[i].parentNode.removeChild(li[i]); return;
					}
				}
			}
		}
	}
	function contextmenu()
	{
		alert("Это был клик правой кнопкой"); return false;
	}
	function dblclick()
	{
		alert("Это был двойной клик по элементу");return false;
	}
	function pupu(e)
	{
		var a = document.getElementById('categories').getElementsByTagName('a');
		var li = document.getElementById('categories').getElementsByTagName('li');
		for(var i=0; i < a.length; i++)
		{
			if(a[i].id==e+'_anchor')
			{
				a[i].click(); li[i].click();
				var ul = li[i].getElementsByTagName('i');
				ul[0].click();
			}
		}
	}
	function pu(e)
	{
		var a = document.getElementById('categories').getElementsByTagName('a');
		var li = document.getElementById('categories').getElementsByTagName('li');
		
		var params = {pu: e,};
		$.ajax({
			url: './php/red.php',
			method: 'GET',
			data: params,
			dataType: 'json',
			success: function(resp) 
			{
				for(var i=0; i < a.length; i++)
				{
					if(li[i].id==resp)
					{ 
						var at = li[i].getAttribute('class');
						if(at == "jstree-node jstree-closed" || at == "jstree-node  jstree-closed" || at == "jstree-node  jstree-closed jstree-last" || at == "jstree-node  jstree-closed jstree-last" || at == "jstree-node jstree-last jstree-closed")
						{
							//li[i].setAttribute('class', 'jstree-node jstree-open');
							//li[i].setAttribute('aria-expanded', 'true');
							li[i].getElementsByTagName('i')[0].click();
							for(var i=0; i < a.length; i++)
							{
								if(a[i].id==e+'_anchor')
								{
									a[i].click();
									//li[i].className='jstree-node jstree-open';
									//li[i].setAttribute("aria-expanded", "true");
									var ul = li[i].getElementsByTagName('i');
									ul[0].click();
									var ull = li[i].getElementsByTagName('ul');
									var lll = ull[0].getElementsByTagName('li');
									for(var z=0; z < lll.length; z++)
									{
										if(lll[z].id==r[1])
										{
											lll[z].getElementsByTagName('a')[0].click();
										}
									}
								}
							}
						}
						else
						{
							for(var i=0; i < a.length; i++)
							{
								if(a[i].id==e+'_anchor')
								{
									a[i].click();
									//li[i].className='jstree-node jstree-open';
									//li[i].setAttribute("aria-expanded", "true");
									var ul = li[i].getElementsByTagName('i');
									ul[0].click();
									var ull = li[i].getElementsByTagName('ul');
									var lll = ull[0].getElementsByTagName('li');
									for(var z=0; z < lll.length; z++)
									{
										if(lll[z].id==r[1])
										{
											lll[z].getElementsByTagName('a')[0].click();
										}
									}
								}
							}
						}
					}
				}
			}
			});
	}
	function ty() //получить всех 
	{
		document.getElementById('kar').setAttribute("class", "disabled");
		document.getElementById('nokar').click();
		var a = document.getElementById('categories').getElementsByTagName('a');
		for(var i=0; i < a.length; i++)
		{
			a[i].setAttribute('class', 'jstree-anchor');
		}
		
		document.getElementById('ty').setAttribute('style', 'background:#beebff !important; color: black;');
		
		document.getElementById('tyty').value="true";
		
		var params = {allsyb: 1,};
		$.ajax({
		url: './php/red.php',
		method: 'GET',
		data: params,
		dataType: 'json',
		success: function(resp) 
		{
			document.getElementById('svtable').removeAttribute('hidden');
			document.getElementById('idd').removeAttribute('hidden');
			document.getElementById('idd2').removeAttribute('hidden');
			
			var svname = document.getElementById('svname');
			svname.innerHTML='';
			svname.appendChild(document.createTextNode("Управление ЖКХ"));
			
			var svadres = document.getElementById('svadres');
			svadres.innerHTML='';
			svadres.appendChild(document.createTextNode(resp.odin[0]));
			
			var svpred = document.getElementById('svpred');
			svpred.innerHTML='';
			svpred.appendChild(document.createTextNode(resp.odin[1]));
			
			var svtel = document.getElementById('svtel');
			svtel.innerHTML='';
			svtel.appendChild(document.createTextNode(resp.odin[2]));
			
			
			var tablekp1 = document.getElementById('tableKP1'); 
			tablekp1.innerHTML='';
			
			var tr = document.createElement('tr');
				tablekp1.appendChild(tr);
				
			var th = document.createElement('th');
				th.appendChild(document.createTextNode("Название"));
				tr.appendChild(th);
			var th = document.createElement('th');
				th.appendChild(document.createTextNode("Всего КП"));
				tr.appendChild(th);
			var th = document.createElement('th');
				th.appendChild(document.createTextNode("Согласованных КП"));
				tr.appendChild(th);	
			var th = document.createElement('th');
				th.appendChild(document.createTextNode("Несогласованных КП"));
				tr.appendChild(th);
				
			for(var z=0; z < resp.to.length; z++)
			{
				var tr = document.createElement('tr');
				tr.addEventListener("click", myfunction, false);
				tr.setAttribute('ondblclick', 'pupu('+resp.to[z][0]+'); return false;');
				//tr.addEventListener("dblclick", dblclick, false);
				//tr.addEventListener("contextmenu", contextmenu, false);
				tablekp1.appendChild(tr);
					
				var td = document.createElement('td');
					tr.appendChild(td);
				var a = document.createElement('a');
					a.setAttribute('id', resp.to[z][0]);
					a.appendChild(document.createTextNode( resp.to[z][1] ));
					a.style.textDecoration='none';
					a.style.cursor='default';
					td.appendChild(a);
					
				var td = document.createElement('td');
					tr.appendChild(td);
					td.appendChild(document.createTextNode(parseInt(resp.to[z][2]) + parseInt(resp.to[z][3])));
				
				var td = document.createElement('td');
					tr.appendChild(td);
					td.appendChild(document.createTextNode(resp.to[z][2]));
					
				var td = document.createElement('td');
					tr.appendChild(td);
					td.appendChild(document.createTextNode(resp.to[z][3]));
			}
		}
		});
	}
	function test()
	{
		var arm;
		var a = document.getElementById('categories').getElementsByTagName('a');
		var li = document.getElementById('categories').getElementsByTagName('li');
		var r = document.location.search.split('=');
		if(r[0]=="?tools") //пытаемся сделать фокус в дереве
		{
			var params = {spravka: r[1],};
				$.ajax({
				url: './php/s.php',
				method: 'GET',
				data: params,
				dataType: 'json',
				success: function(resp) 
				{
					if(resp==0)
					{
						for(var i=0; i < a.length; i++)
						{
							if(a[i].id==r[1]+'_anchor')
							{
								a[i].click();
								li[i].className='jstree-node jstree-open';
								li[i].setAttribute("aria-expanded", "true");
								var ul = li[i].getElementsByTagName('i');
								ul[0].click();
							}
						}
					}
					else
					{
						for(var i=0; i < a.length; i++)
						{
							if(a[i].id==resp+'_anchor')
							{
								a[i].click();
								li[i].className='jstree-node jstree-open';
								li[i].setAttribute("aria-expanded", "true");
								var ul = li[i].getElementsByTagName('i');
								ul[0].click();
								var ull = li[i].getElementsByTagName('ul');
								var lll = ull[0].getElementsByTagName('li');
								for(var z=0; z < lll.length; z++)
								{
									if(lll[z].id==r[1])
									{
										//lll[z].getElementsByTagName('a')[0].click();
										arm = lll[z].getElementsByTagName('a')[0];
										setTimeout(() => {  arm.click(); }, 1000);
									}
								}
							}
						}
					}
				}
				});
		}
		else
		{
			ty();
			/*a[0].click();
			li[0].className='jstree-node jstree-open';
			li[0].setAttribute("aria-expanded", "true");
			var ul = li[0].getElementsByTagName('i');
			ul[0].click();*/
		}
	}
	function red1()
	{
		var IDParam = document.getElementById('IDParam').value;
		if(IDParam == "")
		{
			alert("Не выбран элемент");
		}
		else
		{
			document.location.href ='passOrg.php?id='+IDParam;
		}
	}
	function del1()
	{
		var IDParam = document.getElementById('IDParam').value;
		if(IDParam == "")
		{
			alert("Не выбран элемент");
		}
		else
		{
			if (confirm("Вы уверены?"))
			{
				var params = {id_red2: IDParam, del: 1,};
							$.ajax({
							url: './php/s.php',
							method: 'GET',
							data: params,
							dataType: 'json',
							success: function(resp) 
							{
								alert("Удалено"); location.reload();
							}
							});
			}
		}
	}
	function add2Otm()
	{
		let sybtko = document.getElementById('sybtko').innerHTML = '';
	}
	function add2Save()
	{
		let add2SaveText = document.getElementById('add2SaveText').value;
		if(add2SaveText != "")
		{
			var params = {add2Save: 1, add2SaveText: add2SaveText};
			$.ajax({
				url: './php/s.php',
				method: 'GET',
				data: params,
				dataType: 'json',
				success: function(resp) 
				{
					alert("Добавлено"); 
					document.location.href = 'obtko.php?tools=resp';
				}
			});
		}
		else
		{
			alert("Введите название нового субъекта ТКО");
		}
	}
	function add2()
	{
		let sybtko = document.getElementById('sybtko');
		sybtko.innerHTML = '';
		let inp = document.createElement('input');
		inp.setAttribute('type', 'text');
		inp.setAttribute('id', 'add2SaveText');
		inp.setAttribute('placeholder', 'Введите название');
		sybtko.appendChild(inp);
		
		let inp2 = document.createElement('input');
		inp2.setAttribute('type', 'button');
		inp2.setAttribute('value', 'Сохранить');
		inp2.setAttribute('onclick', 'add2Save();');
		sybtko.appendChild(inp2);
		
		let inp3 = document.createElement('input');
		inp3.setAttribute('type', 'button');
		inp3.setAttribute('value', 'Отменить');
		inp3.setAttribute('onclick', 'add2Otm();');
		sybtko.appendChild(inp3);
	}
	function myfunction(e)
	{
		var tablekp1 = document.getElementById('tableKP1');
		for (let i = 0; i < tablekp1.childNodes.length; i++) 
		{ 
		  tablekp1.childNodes[i].style.backgroundColor = "#FFFFFF";
		}
		this.style.backgroundColor = "#f3bd48";
		
		var r = document.getElementById('idRow');
		r.value = this.rowIndex;
		//alert(r.value);
	}
	function add()
	{
		if(document.getElementById('tyty').value=="true")
		{
			document.location.href ='addsybtko.php';
		}
		else
		{
			var IDParam = document.getElementById('IDParam').value;
			if(IDParam==""){alert("Не выбран элемент");}
			var params = {add: IDParam,};
			$.ajax({
			url: './php/s.php',
			method: 'GET',
			data: params,
			dataType: 'json',
			success: function(resp) 
			{
				if(resp==1)
				{
					//window.open('addkp.php?id='+IDParam, '_blank');
					document.location.href = 'addkp.php?id='+IDParam;
				}
				else
				{
					document.location.href ='addpassOrg.php?id='+IDParam;
				}
			}
			});
		}
	}
	function del()
	{
		var r = document.getElementById('idRow').value;
		if(r=="")
		{
			alert("Вы не выбрали строку!");
		}
		else
		{
			var table = document.getElementById('tableKP1');
			var t = table.rows[r].cells[0].childNodes[0].search;
			if( document.getElementById('tyty').value=="true" )
			{
				if (confirm("Вы уверены?"))
				{
					var t = table.rows[r].cells[0].childNodes[0].id;
					
						var params = {id_red2: t, del: 1,};
							$.ajax({
							url: './php/s.php',
							method: 'GET',
							data: params,
							dataType: 'json',
							success: function(resp) 
							{
								alert("Удалено");
								//table.deleteRow(r);
								//DerevoDel(t,"");
								document.location.href ='obtko.php';
							}
							});
				}
			}
			else
			{
				if(t=="")
				{
					t = table.rows[r].cells[0].childNodes[0].textContent;
					tt = table.rows[r].cells[0].id;
					if (confirm("Вы уверены?"))
					{
						var params = {id_red3: tt, del: 1,};
							$.ajax({
							url: './php/s.php',
							method: 'GET',
							data: params,
							dataType: 'json',
							success: function(resp) 
							{
								alert("Удалено"); document.location.href ='obtko.php?tools='+resp['id'];
								/*table.deleteRow(r);
								
								var svname = document.getElementById('svname');
								svname.innerHTML='';
								svname.appendChild(document.createTextNode(resp['name']));
								
								var svadres = document.getElementById('svadres');
								svadres.innerHTML='';
								svadres.appendChild(document.createTextNode( parseInt(resp['count_soglas_kp']) + parseInt(resp['count_nesoglas_kp']) ));
								
								var svpred = document.getElementById('svpred');
								svpred.innerHTML='';
								svpred.appendChild(document.createTextNode(resp['count_soglas_kp']));
								
								var svtel = document.getElementById('svtel');
								svtel.innerHTML='';
								svtel.appendChild(document.createTextNode(resp['count_nesoglas_kp']));
								
								DerevoDel(tt, resp['id']);*/
							}
							});
					}
				}
				else
				{
					var res = t.split('=').pop();
					if (confirm("Вы уверены?")) 
					{
						var params = {id_red: res, del: 1,};
							$.ajax({
							url: './php/s.php',
							method: 'GET',
							data: params,
							dataType: 'json',
							success: function(resp) 
							{
								alert("Удалено КП");
								table.deleteRow(r);
								
								var svname = document.getElementById('svname');
								svname.innerHTML='';
								svname.appendChild(document.createTextNode(resp['name']));
								
								var svadres = document.getElementById('svadres');
								svadres.innerHTML='';
								svadres.appendChild(document.createTextNode( parseInt(resp['count_soglas_kp']) + parseInt(resp['count_nesoglas_kp']) ));
								
								var svpred = document.getElementById('svpred');
								svpred.innerHTML='';
								svpred.appendChild(document.createTextNode(resp['count_soglas_kp']));
								
								var svtel = document.getElementById('svtel');
								svtel.innerHTML='';
								svtel.appendChild(document.createTextNode(resp['count_nesoglas_kp']));
							}
							});
					}
				}
			}
		}
	}
	function red()
	{
		var table = document.getElementById('tableKP1');
		var r = document.getElementById('idRow').value;
		if(r=="")
		{
			alert("Вы не выбрали строку!");
		}
		var t = table.rows[r].cells[0].childNodes[0].search;
		if( document.getElementById('tyty').value=="true" )
		{

			var t = table.rows[r].cells[0].childNodes[0].id;
			document.location.href ='passOrg.php?id='+t;
		}
		else if(t=="")
		{
			t = table.rows[r].cells[0].childNodes[0].textContent;
			var tt = table.rows[r].cells[0].id;
			document.location.href ='passOrg.php?id='+tt;
		}
		else
		{
			var res = t.split('=').pop();
			document.location.href = 'passKP.php?id='+res;
			//window.open('passKP.php?id='+res, '_blank');
		}
	}
	function table_build(data, texts) //кликаем по дереву - срабатывает событие и попадаем сюда.
	{
		document.getElementById('idRow').value=""; document.getElementById('ty').setAttribute('style', 'color: black;');
		document.getElementById('tyty').value="";
		var params = {id_upr: data,};
		$.ajax({
		url: './php/s.php',
		method: 'GET',
		data: params,
		dataType: 'json',
		success: function(resp) 
		{
			var arr = new Array(); //свойства выбранного в дереве элемента
			var arr2 = new Array(); //массив КП
			var arr3 = new Array(); //массив управляшек если выбран субъект ТКО
			var arr4 = new Array(); //массив кп для точек на карте если выбран субъект тко и надо показать все вложенные кп во все управляшки подчиненные выбранному субъекту тко

			for (i in resp)
			{
				if(i=="result"){document.getElementById('kar').removeAttribute("class");}
				A = resp[i];
				for (j in A)
				{
					X = A[j];
					if(i=="code")
					{
						arr[j] = [X];
					}
					if(i=="result")
					{
						arr2[j] = [X];
					}
					if(i=="upr")
					{
						arr3[j] = [X];
					}
					if(i=="uzt")
					{
						arr4[j] = [X];
					}
				}
			}
			
			document.getElementById('svtable').removeAttribute('hidden');
			document.getElementById('idd').removeAttribute('hidden');
			document.getElementById('idd2').removeAttribute('hidden');
			
			var tet = arr['name'].toString();
			if(tet.length > 40){ tet = tet.substring(0,40)+'...'; }
			var svname = document.getElementById('svname');
			svname.innerHTML='';
			svname.appendChild(document.createTextNode(tet));
			svname.setAttribute('atr', arr['id']);
			
			var svadres = document.getElementById('svadres');
			svadres.innerHTML='';
			svadres.appendChild(document.createTextNode( parseInt(arr['count_soglas_kp']) + parseInt(arr['count_nesoglas_kp']) ));
			
			var svpred = document.getElementById('svpred');
			svpred.innerHTML='';
			svpred.appendChild(document.createTextNode(arr['count_soglas_kp']));
			
			var svtel = document.getElementById('svtel');
			svtel.innerHTML='';
			svtel.appendChild(document.createTextNode(arr['count_nesoglas_kp']));
			
			var tablekp1 = document.getElementById('tableKP1'); tablekp1.innerHTML='';
			var redadd = document.getElementById('redadd');
				//redadd.removeAttribute('hidden');
			myMap.geoObjects.removeAll();

			if(arr2.length > 0)
			{
				var tr = document.createElement('tr');
				tablekp1.appendChild(tr);
				
				var th = document.createElement('th');
				tr.appendChild(th);
				th.appendChild(document.createTextNode('Номер КП'));
				var th2 = document.createElement('th');
				tr.appendChild(th2);
				th2.appendChild(document.createTextNode('Адрес КП'));
				
				var th3 = document.createElement('th');
				tr.appendChild(th3);
				th3.appendChild(document.createTextNode('Согласовано'));
				
				for(var i=0; i < arr2.length; i++)
				{
					var tr = document.createElement('tr');
					tr.addEventListener("click", myfunction, false);
					tablekp1.appendChild(tr);
					for(var z=0; z < arr2[i].length; z++)
					{
						for(var zz=0; zz < arr2[i][z].length; zz++)
						{
							if(zz !=2 )
							{	var rt;
								if(zz==0)
								{
									var td = document.createElement('td');
									td.style="text-align: center";
									tr.appendChild(td);
									var a = document.createElement('a');
									a.appendChild(document.createTextNode(arr2[i][z][zz]));
									td.appendChild(a);
									a.style.textDecoration='none';
									a.style.cursor='default';
									//a.setAttribute('href', 'passKP.php?id='+arr2[i][z][2]);
									td.setAttribute('ondblclick', 'relo('+arr2[i][z][2]+')');
									
								}
								else if(zz==3)
								{
									if(arr2[i][z][zz]=='1'){rt='Да';}else{rt='Нет';}
									var td = document.createElement('td');
									tr.appendChild(td);
									td.appendChild(document.createTextNode(rt));
								}
								else if(zz==4)
								{
									var myGeoObject = new ymaps.GeoObject({
										geometry: {
											type: "Point", // тип геометрии - точка
											coordinates: [arr2[i][z][4], arr2[i][z][5]] // координаты точки
										}
									});
									myMap.geoObjects.add(myGeoObject);
									// Создание метки 
									if(rt=="Да")
									{
										var myPlacemark = new ymaps.Placemark
										(
											// Координаты метки
											[arr2[i][z][4], arr2[i][z][5]], 
											{
												balloonContent: 'КП № <a href=passKP.php?id='+arr2[i][z][2]+'>'+arr2[i][z][0]+'</a>'
											},
											{ 
												preset: 'islands#greenIcon'
											}
										);
										myMap.geoObjects.add(myPlacemark);
									}
									else
									{
										var myPlacemark = new ymaps.Placemark
										(
											// Координаты метки
											[arr2[i][z][4], arr2[i][z][5]], 
											{
												balloonContent: 'КП № <a href=passKP.php?id='+arr2[i][z][2]+'>'+arr2[i][z][0]+'</a>'
											},
											{ 
												preset: 'islands#redIcon'
											}
										);
										myMap.geoObjects.add(myPlacemark);
									}
									
									myMap.setCenter([arr2[i][z][4], arr2[i][z][5]]);
								}
								else if(zz==5){}
								else
								{
									var td = document.createElement('td');
									tr.appendChild(td);
									td.appendChild(document.createTextNode(arr2[i][z][zz]));
								}
							}
						}
					}
				}
			}
			else if(arr3.length > 0)
			{
				document.getElementById('kar').setAttribute("class", "disabled");
				document.getElementById('nokar').click();
				var tr = document.createElement('tr');
				tablekp1.appendChild(tr);
				
				var th0 = document.createElement('th');
				tr.appendChild(th0);
				th0.appendChild(document.createTextNode('Название'));
				
				var th = document.createElement('th');
				tr.appendChild(th);
				th.appendChild(document.createTextNode('Всего КП'));
				var th2 = document.createElement('th');
				tr.appendChild(th2);
				th2.appendChild(document.createTextNode('Согласованных КП'));
				var th3 = document.createElement('th');
				tr.appendChild(th3);
				th3.appendChild(document.createTextNode('Несогласованных КП'));

				for(var i=0; i < arr3.length; i++)
				{
					var tr = document.createElement('tr');
					tr.addEventListener("click", myfunction, false);
					tablekp1.appendChild(tr);
					for(var z=0; z < arr3[i].length; z++)
					{
						for(var zz=0; zz < arr3[i][z].length; zz++)
						{
							if(zz==0 || zz==1 || zz==9 || zz==10)
							{
								if(zz==0)
								{
									var td = document.createElement('td'); 
									td.setAttribute("id", arr3[i][z][zz]);
									tr.appendChild(td);
									var a = document.createElement('a');
									td.setAttribute('ondblclick', 'pu('+arr3[i][z][zz]+'); return false;');
									a.appendChild(document.createTextNode(arr3[i][z][1]));
									a.style.textDecoration='none';
									a.style.cursor='default';
									td.appendChild(a);
								}
								else if(zz==1)
								{
									var td = document.createElement('td');
									tr.appendChild(td);
									td.appendChild(document.createTextNode( parseInt(arr3[i][z][9]) + parseInt(arr3[i][z][10]) ));
								}
								else if(zz==9)
								{
									var td = document.createElement('td');
									tr.appendChild(td);
									td.appendChild(document.createTextNode(arr3[i][z][zz]));
								}
								else if(zz==10)
								{
									var td = document.createElement('td');
									tr.appendChild(td);
									td.appendChild(document.createTextNode(arr3[i][z][zz]));
								}
							}
						}
					}
				}
			}
			/*for(var i=0; i < arr4.length; i++)
				{
					var myGeoObject = new ymaps.GeoObject({
						geometry: {
							type: "Point", // тип геометрии - точка
							coordinates: [arr4[i][0][2], arr4[i][0][3]] // координаты точки
						}
					});
					myMap.geoObjects.add(myGeoObject);
					// Создание метки 
					var myPlacemark = new ymaps.Placemark(
					// Координаты метки
					[arr4[i][0][2], arr4[i][0][3]], {
					balloonContent: 'КП № <a href=passKP.php?id='+arr4[i][0][0]+'>'+arr4[i][0][1]+'</a>'
					});
					myMap.geoObjects.add(myPlacemark);
					myMap.setCenter([56.99, 40.97]);
				}*/
		}
		});
	}
	</script>
  </head>
 <body>
<!--
<div class='v4header' style='position:relative;'>
	<img class='flagzdanie' src='/img/flag.png' alt='Флаг' style='float:left;z-index:1;height:149px;'>
	<img class='flagzdanie' src='/img/zdanie.png' alt='Здание' style='float:right;z-index:1;height:149px;'>
	<a href='/'><img src='/img/of-site.png' style='max-width:287px;margin:0 auto;z-index:2;position:absolute;left:50%;right:50%;margin-left:-143px;' alt='Официальный сайт администрации города Иванова учёт мест накопления твердых бытовых отходов'></a>
</div>
-->

<table style="width: 100%; height: 40px; background: linear-gradient(-45deg, #FEE864, #F5965E);">
	<tr>
		<td style="width: 33%; text-align: left; vertical-align: middle;">
			
		</td>
		<td style="width: 33%; text-align: center; padding: 1em 0; color: #f4f4f4;text-shadow: 1px 1px 2px black, 0 0 1em red;  font-weight: 600; vertical-align: middle;">
			Учёт контейнерных площадок в г. Иваново
		</td>
		<td style="width: 33%; text-align: right; padding: 0px 25px 0px 0px; vertical-align: middle;">
			Пользователь: <?php echo $_SESSION['username'];?> <a href="loguot.php"><u>Выход</u></a>
		</td>
	</tr>
</table>
<style>
..leftstr, .rightstr {
    float: left; /* Обтекание справа */ 
    width: 49%; /* Ширина текстового блока */ 
   }
   .rightstr {
    text-align: right; /* Выравнивание по правому краю */ 
   }
   td{ padding-left: 5px; }
   th{ padding-left: 5px; }
   a.disabled 
   {
		pointer-events: none; /* делаем ссылку некликабельной */
		cursor: default;  /* устанавливаем курсор в виде стрелки */
		color: #999; /* цвет текста для нективной ссылки */
	}
</style>
	<p class="leftstr">&nbsp;&nbsp;<a href="search.php"><u>Поиск КП</u></a>&nbsp;&nbsp;&nbsp;<a href="parser.php"><u>Загрузить из файла</u></a></p>
	<div style="clear: left"></div>
<div class="content100">
	   <!-- ------- установим стили блока DIV -------- -->
<style>
#line_block {
        width: 40%;
        background:#f1f1f1; 
        float:left; 
        margin: 0 15px 15px 0; 
        text-align:left;
        padding: 10px;
        }
		#line_block2 { 
        width: 57%;
		min-height: 70vh;
        background:#f1f1f1; 
        float:left; 
        margin: 0 15px 15px 0; 
        text-align:center;
        padding: 10px;
        }
..sv
{
	width: 100%;
	height: 50px;
}
..tt
{
	width: 100%;
}

tr:hover {
    background: #f3bd48; /* Цвет фона при наведении */
    /* color: #fff; Цвет текста при наведении */
   }
..button:hover
   {
		box-shadow: inset 0 0 1px #999999;
		-moz-box-shadow: inset 0 0 1px #999999;
		-o-box-shadow: inset 0 0 1px #999999;
		-ms-box-shadow: inset 0 0 1px #999999;
		-webkit-box-shadow: inset 0 0 1px #999999;
		background: #beebff;
   }
</style>
   <!-- ---------- вставим блоки на страницу --------- -->
<div style="width:100%; height:1px; clear:both;"></div> <!-- выравниваем без обтекания -->

<div id="line_block">
<div style="cursor: pointer;"><b><a onclick="ty(); false;" style="color: black;" id="ty">Управление ЖКХ</a></b></div>
		<div width="100%" style="overflow-y: scroll; height: 80vh;">
			<div id="categories" class="column categories">
				<img src="img/loading.gif" alt="" width="25%">
			</div>
		</div>
		<div width="100%">
			<div id="goods" class="column"></div>
		</div>
		<input type="hidden" id="IDParam" name="IDParam" value="">
	<!-- Загружаем js-скрипты для дерева объектов -->
	<script src="js/vendor/jstree.min.js" type="text/javascript"></script>
	<script src="js/modules/main.js" type="text/javascript"></script>
</div> 

<div id="line_block2">
<b>Свойства:</b>
	<div style="height: 80vh;">
		<div class="sv">
			<table border='1' style="width: 100%; text-align: left;" id="svtable" hidden='hidden'>
			<tr>
				<th>Название</th>
				<th>Всего КП</th>
				<th>Согласованных КП</th>
				<th>Несогласованных КП</th>
			</tr>
			<tr>
				<td id="svname" style="text-overflow: ellipsis; overflow: hidden; white-space: nowrap; "></td>
				<td id="svadres"></td>
				<td id="svpred"></td>
				<td id="svtel"></td>
			</tr>
			</table>
		</div>
		<div id="idd2" hidden='hidden'>
			<input style="margin-top: 0px; margin-bottom: 3px; border: 2px solid #1E90FF;" class="button" type="button" value="Паспорт" onclick="pasp();">
		</div>
		<div style="width: 100%; background-color: #d0e2f4; height: 15px;">
		</div>
		<div class="tt">
			<ul class="nav nav-tabs">
				  <li class="active"><a data-toggle="tab" href="#panel1" id="nokar">Таблица</a></li>
				  <li><a data-toggle="tab" href="#panel2" class="disabled" id="kar">Карта</a></li>
			</ul>
			<div class="tab-content">
			  <div id="panel1" class="tab-pane fade in active">
				<div id="scrol" style="overflow-y: scroll; height: 53vh;">
					<!--<b>Дочерние элементы:</b>-->
					<table border='1' id="tableKP1" style="width: 100%; text-align: left; margin-top: 1px; background-color: #FFFFFF;"></table>
				</div> <input type="hidden" id="idRow" name="IDParam" value="">
				<div style="margin-top: 3px;" id="idd" hidden='hidden'>
					<input class="button" type="button" value="Добавить" onclick="add();">
					<input class="button" type="button" value="Изменить" onclick="red();">
					<input class="button" type="button" value="Удалить" onclick="del();">
				</div>
			  </div>
			  <div id="panel2" class="tab-pane fade">
				<div id="YMapsID" style="width: 100%; height: 60vh;"></div>
			  </div>
			</div>	
		</div>
	</div>
</div>

<div style="width:100%; height:1px; clear:both;"></div> <!-- выравниваем без обтекания --> 

	<div hidden='hidden' id="tyty"></div>
</div>
<script>
const availableScreenWidth = window.screen.availWidth;
const availableScreenHeight = window.screen.availHeight;
var scrol = document.getElementById('scrol');
if(availableScreenHeight > 1000)
{
	scrol.style="height: 62vh; overflow-y: scroll;";
}
setTimeout(() => {  test(); }, 1000);
</script>
 </body>
</html>